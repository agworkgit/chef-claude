{"ast":null,"code":"/**\n * See the registered mapping of HF model ID => Novita model ID here:\n *\n * https://huggingface.co/api/partners/novita/models\n *\n * This is a publicly available mapping.\n *\n * If you want to try to run inference for a new model locally before it's registered on huggingface.co,\n * you can add it to the dictionary \"HARDCODED_MODEL_ID_MAPPING\" in consts.ts, for dev purposes.\n *\n * - If you work at Novita and want to update this mapping, please use the model mapping API we provide on huggingface.co\n * - If you're a community member and want to add a new supported HF model to Novita, please open an issue on the present repo\n * and we will tag Novita team members.\n *\n * Thanks!\n */\nimport { isUrl } from \"../lib/isUrl.js\";\nimport { delay } from \"../utils/delay.js\";\nimport { omit } from \"../utils/omit.js\";\nimport { BaseConversationalTask, BaseTextGenerationTask, TaskProviderHelper } from \"./providerHelper.js\";\nimport { InferenceClientInputError, InferenceClientProviderApiError, InferenceClientProviderOutputError } from \"../errors.js\";\nconst NOVITA_API_BASE_URL = \"https://api.novita.ai\";\nexport class NovitaTextGenerationTask extends BaseTextGenerationTask {\n  constructor() {\n    super(\"novita\", NOVITA_API_BASE_URL);\n  }\n  makeRoute() {\n    return \"/v3/openai/chat/completions\";\n  }\n}\nexport class NovitaConversationalTask extends BaseConversationalTask {\n  constructor() {\n    super(\"novita\", NOVITA_API_BASE_URL);\n  }\n  makeRoute() {\n    return \"/v3/openai/chat/completions\";\n  }\n}\nexport class NovitaTextToVideoTask extends TaskProviderHelper {\n  constructor() {\n    super(\"novita\", NOVITA_API_BASE_URL);\n  }\n  makeRoute(params) {\n    return `/v3/async/${params.model}`;\n  }\n  preparePayload(params) {\n    const {\n      num_inference_steps,\n      ...restParameters\n    } = params.args.parameters ?? {};\n    return {\n      ...omit(params.args, [\"inputs\", \"parameters\"]),\n      ...restParameters,\n      steps: num_inference_steps,\n      prompt: params.args.inputs\n    };\n  }\n  async getResponse(response, url, headers) {\n    if (!url || !headers) {\n      throw new InferenceClientInputError(\"URL and headers are required for text-to-video task\");\n    }\n    const taskId = response.task_id;\n    if (!taskId) {\n      throw new InferenceClientProviderOutputError(\"Received malformed response from Novita text-to-video API: no task ID found in the response\");\n    }\n    const parsedUrl = new URL(url);\n    const baseUrl = `${parsedUrl.protocol}//${parsedUrl.host}${parsedUrl.host === \"router.huggingface.co\" ? \"/novita\" : \"\"}`;\n    const resultUrl = `${baseUrl}/v3/async/task-result?task_id=${taskId}`;\n    let status = \"\";\n    let taskResult;\n    while (status !== \"TASK_STATUS_SUCCEED\" && status !== \"TASK_STATUS_FAILED\") {\n      await delay(500);\n      const resultResponse = await fetch(resultUrl, {\n        headers\n      });\n      if (!resultResponse.ok) {\n        throw new InferenceClientProviderApiError(\"Failed to fetch task result\", {\n          url: resultUrl,\n          method: \"GET\",\n          headers\n        }, {\n          requestId: resultResponse.headers.get(\"x-request-id\") ?? \"\",\n          status: resultResponse.status,\n          body: await resultResponse.text()\n        });\n      }\n      try {\n        taskResult = await resultResponse.json();\n        if (taskResult && typeof taskResult === \"object\" && \"task\" in taskResult && taskResult.task && typeof taskResult.task === \"object\" && \"status\" in taskResult.task && typeof taskResult.task.status === \"string\") {\n          status = taskResult.task.status;\n        } else {\n          throw new InferenceClientProviderOutputError(\"Received malformed response from Novita text-to-video API: failed to get task status\");\n        }\n      } catch (error) {\n        throw new InferenceClientProviderOutputError(\"Received malformed response from Novita text-to-video API: failed to parse task result\");\n      }\n    }\n    if (status === \"TASK_STATUS_FAILED\") {\n      throw new InferenceClientProviderOutputError(\"Novita text-to-video task failed\");\n    }\n    if (typeof taskResult === \"object\" && !!taskResult && \"videos\" in taskResult && typeof taskResult.videos === \"object\" && !!taskResult.videos && Array.isArray(taskResult.videos) && taskResult.videos.length > 0 && \"video_url\" in taskResult.videos[0] && typeof taskResult.videos[0].video_url === \"string\" && isUrl(taskResult.videos[0].video_url)) {\n      const urlResponse = await fetch(taskResult.videos[0].video_url);\n      return await urlResponse.blob();\n    } else {\n      throw new InferenceClientProviderOutputError(`Received malformed response from Novita text-to-video API: expected { videos: [{ video_url: string }] } format, got instead: ${JSON.stringify(taskResult)}`);\n    }\n  }\n}","map":{"version":3,"names":["isUrl","delay","omit","BaseConversationalTask","BaseTextGenerationTask","TaskProviderHelper","InferenceClientInputError","InferenceClientProviderApiError","InferenceClientProviderOutputError","NOVITA_API_BASE_URL","NovitaTextGenerationTask","constructor","makeRoute","NovitaConversationalTask","NovitaTextToVideoTask","params","model","preparePayload","num_inference_steps","restParameters","args","parameters","steps","prompt","inputs","getResponse","response","url","headers","taskId","task_id","parsedUrl","URL","baseUrl","protocol","host","resultUrl","status","taskResult","resultResponse","fetch","ok","method","requestId","get","body","text","json","task","error","videos","Array","isArray","length","video_url","urlResponse","blob","JSON","stringify"],"sources":["/Users/agmacbook/Documents/Courses/Meta - Full Stack/Exercises/meta_fullstack_exercises/6_react_basics/12_review/13_chef_claude/node_modules/@huggingface/inference/dist/esm/providers/novita.js"],"sourcesContent":["/**\n * See the registered mapping of HF model ID => Novita model ID here:\n *\n * https://huggingface.co/api/partners/novita/models\n *\n * This is a publicly available mapping.\n *\n * If you want to try to run inference for a new model locally before it's registered on huggingface.co,\n * you can add it to the dictionary \"HARDCODED_MODEL_ID_MAPPING\" in consts.ts, for dev purposes.\n *\n * - If you work at Novita and want to update this mapping, please use the model mapping API we provide on huggingface.co\n * - If you're a community member and want to add a new supported HF model to Novita, please open an issue on the present repo\n * and we will tag Novita team members.\n *\n * Thanks!\n */\nimport { isUrl } from \"../lib/isUrl.js\";\nimport { delay } from \"../utils/delay.js\";\nimport { omit } from \"../utils/omit.js\";\nimport { BaseConversationalTask, BaseTextGenerationTask, TaskProviderHelper, } from \"./providerHelper.js\";\nimport { InferenceClientInputError, InferenceClientProviderApiError, InferenceClientProviderOutputError, } from \"../errors.js\";\nconst NOVITA_API_BASE_URL = \"https://api.novita.ai\";\nexport class NovitaTextGenerationTask extends BaseTextGenerationTask {\n    constructor() {\n        super(\"novita\", NOVITA_API_BASE_URL);\n    }\n    makeRoute() {\n        return \"/v3/openai/chat/completions\";\n    }\n}\nexport class NovitaConversationalTask extends BaseConversationalTask {\n    constructor() {\n        super(\"novita\", NOVITA_API_BASE_URL);\n    }\n    makeRoute() {\n        return \"/v3/openai/chat/completions\";\n    }\n}\nexport class NovitaTextToVideoTask extends TaskProviderHelper {\n    constructor() {\n        super(\"novita\", NOVITA_API_BASE_URL);\n    }\n    makeRoute(params) {\n        return `/v3/async/${params.model}`;\n    }\n    preparePayload(params) {\n        const { num_inference_steps, ...restParameters } = params.args.parameters ?? {};\n        return {\n            ...omit(params.args, [\"inputs\", \"parameters\"]),\n            ...restParameters,\n            steps: num_inference_steps,\n            prompt: params.args.inputs,\n        };\n    }\n    async getResponse(response, url, headers) {\n        if (!url || !headers) {\n            throw new InferenceClientInputError(\"URL and headers are required for text-to-video task\");\n        }\n        const taskId = response.task_id;\n        if (!taskId) {\n            throw new InferenceClientProviderOutputError(\"Received malformed response from Novita text-to-video API: no task ID found in the response\");\n        }\n        const parsedUrl = new URL(url);\n        const baseUrl = `${parsedUrl.protocol}//${parsedUrl.host}${parsedUrl.host === \"router.huggingface.co\" ? \"/novita\" : \"\"}`;\n        const resultUrl = `${baseUrl}/v3/async/task-result?task_id=${taskId}`;\n        let status = \"\";\n        let taskResult;\n        while (status !== \"TASK_STATUS_SUCCEED\" && status !== \"TASK_STATUS_FAILED\") {\n            await delay(500);\n            const resultResponse = await fetch(resultUrl, { headers });\n            if (!resultResponse.ok) {\n                throw new InferenceClientProviderApiError(\"Failed to fetch task result\", { url: resultUrl, method: \"GET\", headers }, {\n                    requestId: resultResponse.headers.get(\"x-request-id\") ?? \"\",\n                    status: resultResponse.status,\n                    body: await resultResponse.text(),\n                });\n            }\n            try {\n                taskResult = await resultResponse.json();\n                if (taskResult &&\n                    typeof taskResult === \"object\" &&\n                    \"task\" in taskResult &&\n                    taskResult.task &&\n                    typeof taskResult.task === \"object\" &&\n                    \"status\" in taskResult.task &&\n                    typeof taskResult.task.status === \"string\") {\n                    status = taskResult.task.status;\n                }\n                else {\n                    throw new InferenceClientProviderOutputError(\"Received malformed response from Novita text-to-video API: failed to get task status\");\n                }\n            }\n            catch (error) {\n                throw new InferenceClientProviderOutputError(\"Received malformed response from Novita text-to-video API: failed to parse task result\");\n            }\n        }\n        if (status === \"TASK_STATUS_FAILED\") {\n            throw new InferenceClientProviderOutputError(\"Novita text-to-video task failed\");\n        }\n        if (typeof taskResult === \"object\" &&\n            !!taskResult &&\n            \"videos\" in taskResult &&\n            typeof taskResult.videos === \"object\" &&\n            !!taskResult.videos &&\n            Array.isArray(taskResult.videos) &&\n            taskResult.videos.length > 0 &&\n            \"video_url\" in taskResult.videos[0] &&\n            typeof taskResult.videos[0].video_url === \"string\" &&\n            isUrl(taskResult.videos[0].video_url)) {\n            const urlResponse = await fetch(taskResult.videos[0].video_url);\n            return await urlResponse.blob();\n        }\n        else {\n            throw new InferenceClientProviderOutputError(`Received malformed response from Novita text-to-video API: expected { videos: [{ video_url: string }] } format, got instead: ${JSON.stringify(taskResult)}`);\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}